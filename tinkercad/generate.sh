set -e

function main {
  this_script="$1"

  OUTPUT_FILE=aepl-duino-tinkercad-generated.ino

  echo "
// This file has been generated by $this_script
// DO NOT EDIT.
" > $OUTPUT_FILE
  cat_framed_file thirdparty/TimerOne.h >> $OUTPUT_FILE
  cat_framed_file thirdparty/TimerOne.cpp >> $OUTPUT_FILE
  echo '#define TINKERCAD' >> $OUTPUT_FILE
  cat_framed_file ../aepl-duino.ino >> $OUTPUT_FILE
  sed -i '/include.*TimerOne/d' $OUTPUT_FILE
}

function cat_framed_file {
  filepath="$1"

  filename="$(basename $filepath)"
  echo "
////////////////////////////////////////////////////////////////////////////////////////////////////
// BEGIN $filename
////////////////////////////////////////////////////////////////////////////////////////////////////
"
  cat "$filepath"
  echo "
////////////////////////////////////////////////////////////////////////////////////////////////////
// END $filename
////////////////////////////////////////////////////////////////////////////////////////////////////
"
}

main $0
